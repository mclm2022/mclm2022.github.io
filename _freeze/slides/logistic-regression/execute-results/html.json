{
  "hash": "069ca3e6eaf69bd801161cbed7a26e33",
  "result": {
    "markdown": "---\ntitle: \"Logistic regression analysis\"\nsubtitle: \"Methods of Corpus Linguistics (class 6)\"\nauthor: \"Mariana Montes\"\nformat:\n  revealjs:\n    preview-links: auto\n    multiplex: true\n    chalkboard:\n        buttons: false\n    code-fold: true\n    css: styles.css\nexecute:\n  echo: true\nfrom: markdown+emoji\n---\n\n\n\n\n## Outline\n\n\n- Introduction \n- Probabilities, odds and logit \n- Evaluation \n- Interactions \n- Random effects \n\n\n# Introduction\n\n## Set up code\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\" code-line-numbers=\"|1|2-5|6-13|14-15|16-17|19-23\"}\nset.seed(2022)\ngonna <- tibble(variant = rep(\"gonna\", 50), comp_length = rnorm(50, 6, 0.8),\n                register = sample(c(\"formal\", \"informal\"), 50, replace = TRUE, prob = c(0.1, 0.9)))\ngoing_to <- tibble(variant = rep(\"going_to\", 50), comp_length = rnorm(50, 3, 1.2),\n                   register = sample(c(\"formal\", \"informal\"), 50, replace = TRUE, prob = c(0.7, 0.3)))\ngt <- bind_rows(gonna, going_to) %>%\n  mutate(\n    comp_length = if_else(comp_length > 1, comp_length, 1),\n    variant = fct_relevel(variant, \"gonna\"),\n    variant_num = as.numeric(variant)-1,\n    register = fct_relevel(register, \"informal\"),\n    source = factor(sample(letters, n(), replace = TRUE))\n  )\nm1 <- glm(variant ~ comp_length, data = gt, family = binomial(logit))\ngt$fit1 <- m1$fitted.values\nm2 <- glm(variant ~ comp_length + register, data = gt, family = binomial(logit))\ngt$fit2 <- m2$fitted.values\n\ngonna_plot <- ggplot(gt, aes(x = comp_length, y = variant_num)) +\n  geom_point(size = 3) + ylim(0, 1) +\n  labs(x = \"Length of complement\", y = \"Choice of construction\") +\n  scale_y_continuous(breaks = c(0, 1), labels = c(\"gonna\", \"going to\")) +\n  theme_minimal(base_size = 20) + theme(aspect.ratio = 1)\n```\n:::\n\n\n\n\n::: {.footer}\nIntroduction\n:::\n\n## *gonna* dataset\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\nkb_style(filter(gt, variant == \"gonna\"), \"float_left\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper\" style='font-size: 22px; font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; float: left; margin-right: 10px;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> variant </th>\n   <th style=\"text-align:right;\"> comp_length </th>\n   <th style=\"text-align:left;\"> register </th>\n   <th style=\"text-align:right;\"> variant_num </th>\n   <th style=\"text-align:left;\"> source </th>\n   <th style=\"text-align:right;\"> fit1 </th>\n   <th style=\"text-align:right;\"> fit2 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 6.72 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> q </td>\n   <td style=\"text-align:right;\"> 0.008 </td>\n   <td style=\"text-align:right;\"> 0.050 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 5.06 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 0.348 </td>\n   <td style=\"text-align:right;\"> 0.137 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 5.28 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> z </td>\n   <td style=\"text-align:right;\"> 0.233 </td>\n   <td style=\"text-align:right;\"> 0.081 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 4.84 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> i </td>\n   <td style=\"text-align:right;\"> 0.480 </td>\n   <td style=\"text-align:right;\"> 0.221 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 5.74 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> m </td>\n   <td style=\"text-align:right;\"> 0.088 </td>\n   <td style=\"text-align:right;\"> 0.026 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 3.68 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> f </td>\n   <td style=\"text-align:right;\"> 0.946 </td>\n   <td style=\"text-align:right;\"> 0.861 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 5.15 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> j </td>\n   <td style=\"text-align:right;\"> 0.297 </td>\n   <td style=\"text-align:right;\"> 0.111 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 6.22 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> p </td>\n   <td style=\"text-align:right;\"> 0.027 </td>\n   <td style=\"text-align:right;\"> 0.007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 6.60 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> p </td>\n   <td style=\"text-align:right;\"> 0.011 </td>\n   <td style=\"text-align:right;\"> 0.003 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gonna </td>\n   <td style=\"text-align:right;\"> 6.19 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> c </td>\n   <td style=\"text-align:right;\"> 0.029 </td>\n   <td style=\"text-align:right;\"> 0.174 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\nkb_style(filter(gt, variant == \"going_to\"), \"left\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper\" style='font-size: 22px; font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; '>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> variant </th>\n   <th style=\"text-align:right;\"> comp_length </th>\n   <th style=\"text-align:left;\"> register </th>\n   <th style=\"text-align:right;\"> variant_num </th>\n   <th style=\"text-align:left;\"> source </th>\n   <th style=\"text-align:right;\"> fit1 </th>\n   <th style=\"text-align:right;\"> fit2 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 2.75 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> g </td>\n   <td style=\"text-align:right;\"> 0.995 </td>\n   <td style=\"text-align:right;\"> 0.999 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 4.22 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> r </td>\n   <td style=\"text-align:right;\"> 0.817 </td>\n   <td style=\"text-align:right;\"> 0.975 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 4.64 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> x </td>\n   <td style=\"text-align:right;\"> 0.608 </td>\n   <td style=\"text-align:right;\"> 0.929 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 4.77 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> q </td>\n   <td style=\"text-align:right;\"> 0.526 </td>\n   <td style=\"text-align:right;\"> 0.901 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 4.07 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> f </td>\n   <td style=\"text-align:right;\"> 0.869 </td>\n   <td style=\"text-align:right;\"> 0.691 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 1.78 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> y </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 5.25 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> p </td>\n   <td style=\"text-align:right;\"> 0.251 </td>\n   <td style=\"text-align:right;\"> 0.723 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 4.29 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> g </td>\n   <td style=\"text-align:right;\"> 0.789 </td>\n   <td style=\"text-align:right;\"> 0.551 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 1.71 </td>\n   <td style=\"text-align:left;\"> informal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> h </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:right;\"> 0.999 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> going_to </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:left;\"> formal </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:left;\"> c </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n::: {.footer}\nIntroduction\n:::\n\n## Scatterplot\n\nWhat is the relationship between the length of the complement and the choice of *going to/gonna*?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngonna_plot\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/logistic-plot-1.png){width=960}\n:::\n:::\n\n\n::: {.footer}\nIntroduction\n:::\n\n## Linear fit {chalkboard-buttons=\"true\"}\n\nThe relationship is not linear.\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ngonna_plot + \n  geom_smooth(method = \"lm\", se = FALSE, color = \"darkolivegreen4\")\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/logistic-linear-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\" .incremental}\n- The residuals are not normally distributed.\n\n- Not all values are possible (probabilities go between 0 and 1).\n:::\n\n::::\n\n::: {.footer}\nIntroduction\n:::\n\n## Logistic fit\n\nThe fit has an S shape.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngonna_plot +\n  geom_line(aes(y = fit1), color = \"goldenrod\", size = 2)\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/logistic-fit-1.png){width=960}\n:::\n:::\n\n\n::: {.footer}\nIntroduction\n:::\n\n## Model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = variant ~ comp_length + register, family = binomial(logit), \n    data = gt)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9876  -0.2053  -0.0209   0.1067   2.1787  \n\nCoefficients:\n               Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      11.582      2.899    4.00  6.5e-05 ***\ncomp_length      -2.651      0.613   -4.32  1.5e-05 ***\nregisterformal    3.284      1.068    3.08   0.0021 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 138.63  on 99  degrees of freedom\nResidual deviance:  34.02  on 97  degrees of freedom\nAIC: 40.02\n\nNumber of Fisher Scoring iterations: 7\n```\n:::\n:::\n\n\n::: {.footer}\nIntroduction\n:::\n\n## Interpretation {.smaller}\n\n\n\n\n\n:::: {.columns}\n\n::: {.column width=\"35%\" .incremental}\n### Intercept\n\n- **log odds** of outcome (\"going to\") when all predictors are at 0 (`comp_length` = 0).\n\n- odds = `exp(11.582)` = 107138\n\n- prob = odds/(odds+1) $\\approx$ 1\n:::\n\n::: {.column width=\"65%\" .incremental}\n### Coefficients\n\n- **log odds ratios**: positive increases chances of \"going to\", negative of \"gonna\".\n\n- odds ratio\n\n    + of `comp_length` = `exp(-2.651)` = 0.071\n    \n    + of `register` = `exp(3.284)` = 26.676\n\n. . .\n\n> The odds of *going to* vs *gonna* in the formal register are 26.676 times higher than those in the informal register, other variables being controlled for.\n\n:::\n\n::::\n\n::: {.footer}\nIntroduction\n:::\n\n\n\n\n\n# Probabilities, odds and logit\n\n## Probabilities {.smaller}\n\n:::: {.columns}\n\n::: {.column width=\"30%\"}\n###  probs.\n\n- $P$\n\n- 0 - 0.5 - 1\n\n- Number of successes divided by number of trials.\n:::\n\n::: {.column width=\"70%\"}\n\n:::\n\n::::\n\n::: {.footer}\nProbabilities, odds and logit\n:::\n\n## Odds {.smaller}\n\n:::: {.columns}\n\n::: {.column width=\"30%\"}\n### probs.\n\n- $P$\n\n- 0 - 0.5 - 1\n\n- Number of successes divided by number of trials.\n:::\n\n\n::: {.column width=\"30%\"}\n### odds\n\n- $\\frac{P}{1-P}$\n\n- 0 - 1 - $\\infty$\n\n- Probability of success divided by the probability of failure.\n\n- Undefined for $P=1$.\n:::\n\n::: {.column width=\"30%\"}\n\n:::\n\n::::\n\n::: {.footer}\nProbabilities, odds and logit\n:::\n\n## Logit {.smaller}\n\n:::: {.columns}\n\n::: {.column width=\"30%\"}\n###  probs.\n\n- $P$\n\n- 0 - 0.5 - 1\n\n- Number of successes divided by number of trials.\n:::\n\n::: {.column width=\"30%\"}\n### odds\n\n- $\\frac{P}{1-P}$\n\n- 0 - 1 - $\\infty$\n\n- Probability of success divided by the probability of failure.\n\n- Undefined for $P=1$.\n:::\n\n::: {.column width=\"30%\"}\n### logit\n\n- $\\log\\left(\\frac{P}{1-P}\\right)$\n\n- $-\\infty$ - 0 - $\\infty$\n\n- If positive, success is more likely; if negative failure is more likely.\n\n- Undefined for $P=0$ and for $P=1$.\n:::\n\n::::\n\n::: {.footer}\nProbabilities, odds and logit\n:::\n\n## Simulation\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-fold=\"false\" code-line-numbers=\"|3,4,6|8|7,9|10\"}\nlibrary(MASS) # to print fractions\n\nprobabilities <- c(1/c(7:2),\n                   1-(1/c(3:7)))\nprobs <- tibble(\n  P = probabilities,\n  P_frac = as.character(fractions(P)),\n  odds = P/(1-P),\n  odds_frac = as.character(fractions(odds)),\n  logit = log(odds)\n)\nkbl(probs) %>% kable_paper(font_size = 22) %>% \n  row_spec(6, bold = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper\" style='font-size: 22px; font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> P </th>\n   <th style=\"text-align:left;\"> P_frac </th>\n   <th style=\"text-align:right;\"> odds </th>\n   <th style=\"text-align:left;\"> odds_frac </th>\n   <th style=\"text-align:right;\"> logit </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.143 </td>\n   <td style=\"text-align:left;\"> 1/7 </td>\n   <td style=\"text-align:right;\"> 0.167 </td>\n   <td style=\"text-align:left;\"> 1/6 </td>\n   <td style=\"text-align:right;\"> -1.792 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.167 </td>\n   <td style=\"text-align:left;\"> 1/6 </td>\n   <td style=\"text-align:right;\"> 0.200 </td>\n   <td style=\"text-align:left;\"> 1/5 </td>\n   <td style=\"text-align:right;\"> -1.609 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.200 </td>\n   <td style=\"text-align:left;\"> 1/5 </td>\n   <td style=\"text-align:right;\"> 0.250 </td>\n   <td style=\"text-align:left;\"> 1/4 </td>\n   <td style=\"text-align:right;\"> -1.386 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.250 </td>\n   <td style=\"text-align:left;\"> 1/4 </td>\n   <td style=\"text-align:right;\"> 0.333 </td>\n   <td style=\"text-align:left;\"> 1/3 </td>\n   <td style=\"text-align:right;\"> -1.099 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.333 </td>\n   <td style=\"text-align:left;\"> 1/3 </td>\n   <td style=\"text-align:right;\"> 0.500 </td>\n   <td style=\"text-align:left;\"> 1/2 </td>\n   <td style=\"text-align:right;\"> -0.693 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;font-weight: bold;\"> 0.500 </td>\n   <td style=\"text-align:left;font-weight: bold;\"> 1/2 </td>\n   <td style=\"text-align:right;font-weight: bold;\"> 1.000 </td>\n   <td style=\"text-align:left;font-weight: bold;\"> 1 </td>\n   <td style=\"text-align:right;font-weight: bold;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.667 </td>\n   <td style=\"text-align:left;\"> 2/3 </td>\n   <td style=\"text-align:right;\"> 2.000 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.693 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.750 </td>\n   <td style=\"text-align:left;\"> 3/4 </td>\n   <td style=\"text-align:right;\"> 3.000 </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 1.099 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.800 </td>\n   <td style=\"text-align:left;\"> 4/5 </td>\n   <td style=\"text-align:right;\"> 4.000 </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1.386 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.833 </td>\n   <td style=\"text-align:left;\"> 5/6 </td>\n   <td style=\"text-align:right;\"> 5.000 </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 1.609 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.857 </td>\n   <td style=\"text-align:left;\"> 6/7 </td>\n   <td style=\"text-align:right;\"> 6.000 </td>\n   <td style=\"text-align:left;\"> 6 </td>\n   <td style=\"text-align:right;\"> 1.792 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n::: notes\nWe'll create a vector `probabilities` with the values of fractions from $\\frac{1}{7}$ to $\\frac{1}{2}$ and then from $1-\\frac{1}{3}$ to $1-\\frac{1}{7}$.\n\n`MASS::fractions()` prints them as fractions.\n\nFrom there we compute odds and logit.\n:::\n\n::: {.footer}\nProbabilities, odds and logit\n:::\n\n## Probabilities, odds and logits: plots {visibility=\"hidden\"}\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nlnplot(probs, P, logit, \"logit ~ P\")\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nlnplot(probs, P, odds, \"odds ~ P\")\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n:::\n\n::::\n\n::: {.footer}\nProbabilities, odds and logit\n:::\n\n## Linear vs logistic relationships\n\nLinear relation `logit ~ x` entails logistic curve `p ~ x`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwith_x <- tibble(x = 1:30, logit = -3.5 + 0.3*x, odds = exp(logit), P = odds/(1+odds))\n```\n:::\n\n\n:::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nlnplot(with_x, x, logit, \"logit ~ X\")\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nlnplot(with_x, x, P, \"P ~ X\")\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n:::\n::::\n\n::: {.footer}\nProbabilities, odds and logit\n:::\n\n\n\n\n\n# Evaluation\n\n## Model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = variant ~ comp_length + register, family = binomial(logit), \n    data = gt)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9876  -0.2053  -0.0209   0.1067   2.1787  \n\nCoefficients:\n               Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      11.582      2.899    4.00  6.5e-05 ***\ncomp_length      -2.651      0.613   -4.32  1.5e-05 ***\nregisterformal    3.284      1.068    3.08   0.0021 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 138.63  on 99  degrees of freedom\nResidual deviance:  34.02  on 97  degrees of freedom\nAIC: 40.02\n\nNumber of Fisher Scoring iterations: 7\n```\n:::\n:::\n\n\n::: {.footer}\nEvaluation\n:::\n\n## Deviance {.smaller}\n\nNull deviance\n\n:   discrepancy between data and intercept-only model (like SST)\n\nResidual deviance\n\n:   discrepancy between data and fitted model (like SSE)\n\n::: callout-note\n### Computation\n\n$-2 \\log(L)$ with $L$ the likelihood of encountering the data if the model is true.\n:::\n\nAIC (Akaike Information Criterion)\n\n:   corrected residual deviance (to compare models with different N. of predictors) - the smaller the better\n\nDeviance residuals\n\n:   contribution of each observation to the residual deviance.\n\n::: {.footer}\nEvaluation\n:::\n\n## Predicted probability {.smaller}\n\n\n\n\n\n$$g(x) = \\beta_0 + \\beta_1x_1 + \\beta_2x_2 + ...$$\n\nLet's predict the probability of *going to* when complement length is 4 and register is formal.\n\n. . .\n\n$$g(x) = 11.582 + -2.651\\times 4 + 3.284 \\times 1 = 4.26$$\n\n. . .\n\nodds = `exp(4.26)` = 70.802\n\n. . .\n\n$$P(x) = \\frac{70.802}{70.802 + 1} = 0.986$$\n\n::: {.footer}\nEvaluation\n:::\n\n## Measures of predictive power {.smaller}\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nWe take all pairs of observations in which the response variable is different (one of *gonna*, one of *going to*).\n\n- `gt0` is what the model predicted for the \"gonna\" element.\n\n- `gt1` is what the model predicted for the \"going to\" element.\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(0)\npred_power <- tibble(\n  gt0 = sample(filter(gt, variant == \"gonna\")$fit2, 15, replace = FALSE),\n  gt1 = sample(filter(gt, variant == \"going_to\")$fit2, 15, replace = FALSE))\nkb_style(pred_power, n = 15)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper\" style='font-size: 22px; font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> gt0 </th>\n   <th style=\"text-align:right;\"> gt1 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.011 </td>\n   <td style=\"text-align:right;\"> 0.999 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.221 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.009 </td>\n   <td style=\"text-align:right;\"> 0.999 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.050 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.021 </td>\n   <td style=\"text-align:right;\"> 0.895 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.001 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.793 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 0.942 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.090 </td>\n   <td style=\"text-align:right;\"> 0.998 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.265 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 0.514 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.019 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.174 </td>\n   <td style=\"text-align:right;\"> 0.093 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.111 </td>\n   <td style=\"text-align:right;\"> 0.420 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.003 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n:::\n\n::::\n\n::: {.footer}\nEvaluation\n:::\n\n## C, D, T\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n- `C` = concordant pair = prediction is higher for \"going to\" :grin:\n\n- `D` = discordant pair = the prediction is higher for \"gonna\" :frowning_face:\n\n- `T` = tie = the prediction is the same for both :neutral_face:\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\npred_power <- pred_power %>%\n  mutate(C = gt1 > gt0, D = gt0 > gt1, T = gt1 == gt0)\nkb_style(pred_power, n = 15) %>%\n  column_spec(3, background = spec_color(pred_power$C, option = \"H\", begin = 0.8, end = 0.45))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper\" style='font-size: 22px; font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> gt0 </th>\n   <th style=\"text-align:right;\"> gt1 </th>\n   <th style=\"text-align:left;\"> C </th>\n   <th style=\"text-align:left;\"> D </th>\n   <th style=\"text-align:left;\"> T </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.011 </td>\n   <td style=\"text-align:right;\"> 0.999 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.221 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.009 </td>\n   <td style=\"text-align:right;\"> 0.999 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.050 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.021 </td>\n   <td style=\"text-align:right;\"> 0.895 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.001 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.793 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 0.942 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.090 </td>\n   <td style=\"text-align:right;\"> 0.998 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.265 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 0.514 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.019 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.174 </td>\n   <td style=\"text-align:right;\"> 0.093 </td>\n   <td style=\"text-align:left;background-color: rgba(240, 91, 18, 1) !important;\"> FALSE </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.111 </td>\n   <td style=\"text-align:right;\"> 0.420 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.003 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n   <td style=\"text-align:left;background-color: rgba(120, 254, 90, 1) !important;\"> TRUE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n:::\n\n::::\n\n::: {.footer}\nEvaluation\n:::\n\n## C-value\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_power <- pred_power %>%\n  summarize(C = sum(C), D = sum(D), T = sum(T))\nkb_style(pred_power)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper\" style='font-size: 22px; font-family: \"Arial Narrow\", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> C </th>\n   <th style=\"text-align:right;\"> D </th>\n   <th style=\"text-align:right;\"> T </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n. . .\n\n$$c = \\frac{C+T/2}{C+D+T} = \\frac{14+0/2}{14+1+0} = 0.933$$\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nHmisc::somers2(gt$fit2, gt$variant_num)[[\"C\"]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.984\n```\n:::\n:::\n\n\n::: {.footer}\nEvaluation\n:::\n\n\n## Linear vs logistic regression {.smaller}\n\n| | Linear regression | Logistic regression |\n|----------------------|-------------------------|-------------------------|\n| Response variable | Numerical | Categorical |\n| Relationship between predictor estimate and response | Linear | Logistic^[Linear relationship between estimate and log odds of response.] |\n| Fitting function | OSL (ordinary least squares) | MLE (maximum likelihood estimation) |\n| Model comparison | F-test  | AIC |\n| Evaluation metric | $R^2$ | $C$ |\n| Base R function | `lm()` | `glm()` |\n\n::: {.footer}\nEvaluation\n:::\n\n\n\n\n\n# Interactions\n\n## What is an interaction?\n\n::: msg\nWhen the effect of a predictor depends on the value of another predictor.\n:::\n\nFormula: `y ~ x1 + x2 + x1:x2` = `y ~ x1*x2`\n\n::: {.footer}\nInteractions\n:::\n\n## Examples\n\nPossible interactions of complement length and register (is the text formal or informal?) on choice of *gonna*.\n\n- The effect of complement length is also positive/negative but stronger/weaker when texts are informal.\n\n- The effect of complement length is positive/negative when texts are informal, reversed when texts are formal.\n\n::: {.footer}\nInteractions\n:::\n\n## Model with interactions {.smaller}\n\n:::: {.columns}\n\n::: {.column width=\"60%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nm3 <- glm(variant ~ comp_length*register, data = gt, family = binomial(logit))\nsummary(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = variant ~ comp_length * register, family = binomial(logit), \n    data = gt)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.5689  -0.0792  -0.0030   0.1584   1.8033  \n\nCoefficients:\n                           Estimate Std. Error z value Pr(>|z|)   \n(Intercept)                   18.78       7.10    2.64   0.0082 **\ncomp_length                   -4.22       1.55   -2.72   0.0065 **\nregisterformal                -8.39       7.89   -1.06   0.2878   \ncomp_length:registerformal     2.39       1.67    1.43   0.1529   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 138.629  on 99  degrees of freedom\nResidual deviance:  31.103  on 96  degrees of freedom\nAIC: 39.1\n\nNumber of Fisher Scoring iterations: 8\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"40%\"}\n### Interpretation\n\n- Intercept is interpreted in the same way.\n\n- `comp_length` is the effect of complement length *in informal register*.\n\n- `registerformal` is the effect of the formal register at *0 complement length*.\n\n- `comp_length:registerformal` is the difference in the effect of complement length in formal register, compared to informal register.\n\n:::\n\n::::\n\n::: {.footer}\nInteractions\n:::\n\n## Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggeffects)\nplot(ggpredict(m3, c(\"comp_length\", \"register\")))\n```\n\n::: {.cell-output-display}\n![](logistic-regression_files/figure-revealjs/ggeffects-1.png){width=960}\n:::\n:::\n\n\n::: {.footer}\nInteractions\n:::\n\n\n\n\n\n# Random effects\n\n## Fixed vs random effects\n\nUnlike **fixed effects** (what we have dealt with up to now), **random effects**:\n\n- May not be replicable in a different dataset.\n\n- Involve a *sample* of the possible values in the population.\n\nExamples: speaker, lexical effects, topic... &rarr; often operationalized as *filename*.\n\n::: {.footer}\nRandom effects\n:::\n\n## Random intercept\n\n::: msg\nThe intercept can vary.\n:::\n\n. . .\n\n- Different individuals prefer *gonna* over *going to* regardless of complement length.\n\n- Certain children always produce longer utterances than others of the same age.\n\n. . .\n\n::: callout-important\n### Nested random intercept\n\nE.g. random intercept for filename *and* random intercept for register; each filename occurs in only one register.\n:::\n\n::: {.footer}\nRandom effects\n:::\n\n## Random slope\n\n::: msg\nThe slope of a fixed effect can vary.\n:::\n\nA given predictor can have different effects in different texts.\n\n. . .\n\n- Complement length is more influential in the choice of *gonna* for some individuals than for others.\n\n- For certain children, utterance length increases with age at a higher pace than of others.\n\n::: {.footer}\nRandom effects\n:::\n\n## How to\n\n- `lme4::glmer()` instead of `glm()`; `lme4::lmer()` instead of `lm()`.\n\n    + The `control` argument helps us deal with convergence issues.\n\n. . .\n\n- Extension of the R formula:\n\n    + `(1 | filename)` for `filename` as random effect.\n    \n    + `(age | child)` for `child` as a random slope for `age`.\n    \n::: {.footer}\nRandom effects\n:::\n\n## Model with random effects\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nm4 <- lme4::glmer(variant ~ comp_length*register + (1 | source), data = gt, family = binomial)\nsummary(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: binomial  ( logit )\nFormula: variant ~ comp_length * register + (1 | source)\n   Data: gt\n\n     AIC      BIC   logLik deviance df.resid \n    40.7     53.7    -15.3     30.7       95 \n\nScaled residuals: \n   Min     1Q Median     3Q    Max \n-4.041 -0.031 -0.001  0.063  1.343 \n\nRandom effects:\n Groups Name        Variance Std.Dev.\n source (Intercept) 1.6      1.26    \nNumber of obs: 100, groups:  source, 26\n\nFixed effects:\n                           Estimate Std. Error z value Pr(>|z|)  \n(Intercept)                   23.19      11.72    1.98    0.048 *\ncomp_length                   -5.18       2.56   -2.03    0.043 *\nregisterformal               -10.30       9.77   -1.05    0.292  \ncomp_length:registerformal     2.94       2.18    1.35    0.177  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) cmp_ln rgstrf\ncomp_length -0.997              \nregistrfrml -0.829  0.827       \ncmp_lngth:r  0.890 -0.894 -0.985\n```\n:::\n:::\n\n\n::: {.footer}\nRandom effects\n:::\n\n## Compare models\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance::compare_performance(m1, m2, m3, m4, metrics = \"AIC\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# Comparison of Model Performance Indices\n\nName |    Model | AIC (weights)\n-------------------------------\nm1   |      glm |  51.6 (<.001)\nm2   |      glm |  40.0 (0.303)\nm3   |      glm |  39.1 (0.479)\nm4   | glmerMod |  40.7 (0.217)\n```\n:::\n:::\n\n\n::: {.footer}\nRandom effects\n:::\n\n# Next: Correspondence Analysis",
    "supporting": [
      "logistic-regression_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ],
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}